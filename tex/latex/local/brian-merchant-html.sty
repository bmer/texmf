\usepackage{amsmath} % AMS mathmode stuff
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{physics} % for writing derivatives, norms, evaluation symbols, and so on
\usepackage{graphicx} % put in figures
\usepackage{hyperref} % hyper-referencing/link capabilities in PDF
\usepackage{textcomp}
\usepackage{gensymb}
\usepackage[version=3]{mhchem} % easy chemical formula notation
\usepackage{siunitx} % SI units
\usepackage{marginnote} % put notes in the margin, if necessary
\usepackage{enumitem} % refine enumerate
\usepackage{relsize} % change size of stuff relative to other stuff
\usepackage{esdiff} % easy differential equations in mathmode
\usepackage{mathtools} % mathclap etc.
\usepackage{xargs} % Use more than one optional parameter in a new commands
\usepackage{xcolor} % Coloured text etc.
\usepackage{cancel} % text or math cancellation slashes
\usepackage{xparse} % flexible doc cmds (example, more than one optional argument)
\usepackage{xifthen} % use nice if-then-else statements inside forloops (handy for drawing diagrams using TikZ)
\usepackage{textcomp} % for the cent symbol
\usepackage{bm} % bold math symbols
\usepackage{stackengine} % stacking glyphs one on top of the other
\usepackage{url}
\usepackage{xstring} % new command with if statements
\usepackage{varwidth}% creating mini environments with controlled width

\newcommandx{\unsure}[2][1=]{\todo[linecolor=red,backgroundcolor=red!25,bordercolor=red,#1]{#2}}
\newcommandx{\change}[2][1=]{\todo[linecolor=blue,backgroundcolor=blue!25,bordercolor=blue,#1]{#2}}
\newcommandx{\info}[2][1=]{\todo[linecolor=OliveGreen,backgroundcolor=OliveGreen!25,bordercolor=OliveGreen,#1]{#2}}
\newcommandx{\improvement}[2][1=]{\todo[linecolor=Plum,backgroundcolor=Plum!25,bordercolor=Plum,#1]{#2}}

% macro to number specific equations in align* environment
% usage: <equation> /numberthis /label{some-label}
\newcommand\numberthis{\addtocounter{equation}{1}\tag{\theequation}}

\usepackage{fixltx2e}
\def\SP#1{\textsuperscript{#1}}
\def\SB#1{\textsubscript{#1}}
\def\SPSB#1#2{\rlap{\textsuperscript{#1}\textsubscript{#2}}}

\usepackage{csquotes}

\theoremstyle{plain}

\theoremstyle{definition}

\newtheorem{axiom}{Axiom}
\newtheorem{taggedaxiomx}{Axiom}
\newenvironment{taggedaxiom}[1]
{\renewcommand\thetaggedaxiomx{#1}\taggedaxiomx}
{\endtaggedaxiomx}

\newtheorem{fundament}{Fundament}
\newtheorem{taggedfundamentx}{Fundament}
\newenvironment{taggedfundament}[1]
{\renewcommand\thetaggedfundamentx{#1}\taggedfundamentx}
{\endtaggedfundamentx}


\newtheorem{definition}{Definition}

\newtheorem{conjecture}{Conjecture}

\newtheorem*{example}{Example}

\newtheorem{exercise}{Exercise}

\newtheorem{algorithm}{Algorithm}

\newtheorem*{remark}{Remark}

\newtheorem*{fact}{Fact}

\newtheorem{theorem}{Theorem}
\newtheorem{taggedtheoremx}{Theorem}
\newenvironment{taggedtheorem}[1]
{\renewcommand\thetaggedtheoremx{#1}\taggedtheoremx}
{\endtaggedtheoremx}

\newtheorem{proposition}{Proposition}
\newtheorem{lemma}{Lemma}
\newtheorem*{corollary}{Corollary}

\theoremstyle{remark}
\newtheorem*{note}{Note}
\newtheorem{case}{Case}

%======================================

\newenvironment{indenttext}{%
	\par%
	\medskip
	\leftskip=4em\rightskip=2em%
	\noindent\ignorespaces}{%
	\par\medskip}

%======================================

%======================================
% GEOMETRIC ALGEBRA
%\newcommand{\udotdot}{\mathbin{\text{\rotatebox[origin=c]{45}{${\cdot}{\cdot}$}}}}
\makeatletter
\providecommand*{\udotdot}{%
	\mathbin{\mathpalette\@udotdot{}}%
}
\providecommand*{\@udotdot}[2]{%
	% #1: math style
	% #2: unused
	% Box 0: dot
	\sbox0{$#1.\m@th$}%
	% Remove side bearings
	\setbox2=\hbox to \ht0{\hss\copy0\hss}
	% Side bearing
	\dimen2=.5\dimexpr\wd0-\wd2\relax
	% Box 2: equal sign
	\sbox4{$#1=\m@th$}%
	% Box 4: math axis
	\sbox6{$#1\vcenter{}$}%
	\dimen@=\dimexpr(\ht4-\ht6)*2 + \ht0\relax
	\kern\dimen2 % side bearing
	\vcenter to \dimen@{%
		\hbox to \dimen@{\hfill\copy2}%
		\nointerlineskip
		\vfill
		\hbox to \dimen@{\copy2\hfill}%
	}%
	\kern\dimen2 % side bearing
}
\makeatother

\newcommand{\gepr}{\udotdot}
\newcommand{\gesu}{\mathbin{\cdot\cdot}}
\newcommand{\mvec}[1]{\mathbf{\bar{#1}}}
\DeclareDocumentCommand{\nvec}{ O{n} O{} m }{\mathbf{#3}_{#1|#2}}

% to make an operator into a quantifier
\newcommand{\operator}[1]{\mathop{\vphantom{\sum}\mathchoice
		{\vcenter{\hbox{\huge $#1$}}}
		{\vcenter{\hbox{\Large $#1$}}}{#1}{#1}}\displaylimits}

\newcommand{\gesuq}{\operator{\gesu}}
\newcommand{\geprq}{\operator{\gepr}}
%======================================

%============ FMSD MACROS =============
% macros for unified programming and math notations
% needs amsmath package

\newcommand{\sclr}[1]{\ensuremath{\;\;#1\;\;}}
\newcommand{\bclr}[1]{\ensuremath{\quad#1\quad}}


% ==> and <==
\newcommand{\imp}{\;\Rightarrow\;}
\newcommand{\impby}{\;\Leftarrow\;}
\newcommand{\pmi}{\;\impby\;}

% logical and ("et" in Latin), logical or ("vel" in Latin)
\newcommand{\et}{\;\wedge\;}
\newcommand{\vel}{\;\vee\;}

% max and min as up/down arrows: \bmax, \bmin
\newcommand{\bmax}{\mathbin{\uparrow}}
\newcommand{\bmin}{\mathbin{\downarrow}}

% bunch cardinality
\newcommand{\centsym}{
	\stackinset{c}{}{c}{}{c}{/}
}
\DeclareMathOperator{\bsize}{\centsym}

% null bunch
\newcommand{\nul}{\mathit{null}}
% nil string
\newcommand{\nil}{\mathit{nil}}

% some common bunches: nat, xnat, int, xint, rat, xrat
\newcommand{\bin}{\mathit{bin}}
\newcommand{\nat}{\mathit{nat}}
\newcommand{\xnat}{\mathit{xnat}}
\newcommand{\ints}{\mathit{int}}
\newcommand{\xint}{\mathit{xint}}
\newcommand{\rat}{\mathit{rat}}
\newcommand{\xrat}{\mathit{xrat}}
\newcommand{\reals}{\mathit{real}}
\newcommand{\emptybunch}{\mathit{null}}

% 0 \bto 3 = 0,..3
% (b stands for bunch)
\newcommand{\bto}{\mathord{,}..}
% 0 \sto 3 = 0;..3
% (s stands for string)
\newcommand{\sto}{\mathord{;}..}

% the | in "n -> i | L"
\newcommand{\ow}{\mid}

% dependent composition P.Q
\newcommand{\dc}{\mathrel{.}}

% ok
\newcommand{\ok}{\mathit{ok}}

% :=
\newcommand{\get}{\mathpunct{:=}}

% if-then-else
\newcommand{\cond}[3]{\mbox{\textbf{if} $#1$ \textbf{then} $#2$ \textbf{else} $#3$ \textbf{fi}}}
% if-then on a line, else on another
\newcommand{\condb}[3]{\begin{array}[t]{@{}l}\mbox{\textbf{if} $#1$ \textbf{then} $#2$} \\ \mbox{\textbf{else} $#3$ \\ \mbox{\textbf{fi}}}\end{array}}
% if c then
%   stuff
% else
%   fluff
\newcommand{\condbb}[3]{\begin{array}[t]{@{}l}\mbox{\textbf{if} $#1$ \textbf{then}} \\ \quad #2 \\ \mbox{\textbf{else}} \\ \quad #3 \\ \mbox{\textbf{fi}} \end{array}}

% while-do
\newcommand{\while}[2]{\mbox{\textbf{while} $#1$ \textbf{do} $#2$}}
% while-b-do on one line, body on next
\newcommand{\whileb}[2]{\begin{array}[t]{@{}l}\mbox{\textbf{while} $#1$ \textbf{do}} \\ \quad #2 \end{array}}

% function application
\newcommand{\ap}{\,}

% enlarged relation symbol
\newcommand{\bigrel}[1]{\mathrel{\,\mbox{\Large$#1$\small$ $}\,}}

% some common enlarged relation symbols
\newcommand{\Equiv}{\bigrel{\equiv}}
\newcommand{\Eq}{\bigrel{=}}
\newcommand{\Leq}{\bigrel{\leq}}
\newcommand{\Geq}{\bigrel{\geq}}
\newcommand{\Approx}{\bigrel{\approx}}
\newcommand{\Imp}{\bigrel{\Rightarrow}}
\newcommand{\Impby}{\bigrel{\impby}}
\newcommand{\Pmi}{\Impby}
\newcommand{\Et}{\bigrel{\wedge}}
\newcommand{\Vel}{\bigrel{\vee}}
\newcommand{\RSquiggle}{\bigrel{\rightsquigarrow}}
\newcommand{\blankrel}[1]{\mathrel{\phantom{#1}}}
\newcommand{\Blank}{\blankrel{\Imp}}

% function
% with domain: \fun{local_variable}{domain}{body}
% omit domain: \fn{local_variable}{body}
\newcommand{\fun}[3]{\langle #1 \colon #2 \rightarrow #3 \rangle}
\newcommand{\fn}[2]{\langle #1 \to #2 \rangle}

% quantified expressions sans quantifier
% with domain: \bind{local_variable}{domain}{body}
% omit domain: \bnd{local_variable}{body}
\newcommand{\bind}[3]{#1 \colon #2 \cdot #3}
\newcommand{\bnd}[2]{#1 \cdot #2}

% MAX and MIN
\newcommand{\MAX}{\mathop{\mathit{MAX}}}
\newcommand{\MIN}{\mathop{\mathit{MIN}}}

\newcommand{\typeof}[1]{\mathop{?}#1}
\newcommand{\strlen}{\mathop{\leftrightarrow}}

\newcommand{\bunfy}[1]{\mathrm{bunfy}(#1)}
\newcommand{\setfy}[1]{\mathrm{setfy}(#1)}
\newcommand{\strfy}[1]{\mathrm{strfy}(#1)}
\newcommand{\lstfy}[1]{\mathrm{lstfy}(#1)}

\newcommand{\bbun}{\mathit{bunches}}
\newcommand{\bset}{\mathit{sets}}
\newcommand{\bstr}{\mathit{strings}}
\newcommand{\blst}{\mathit{lists}}

\newcommand{\tbun}{\mathrm{bun}}
\newcommand{\tset}{\mathrm{set}}
\newcommand{\tstr}{\mathrm{str}}
\newcommand{\tlst}{\mathrm{lst}}

\newcommand{\inb}{\mathop{\varepsilon}}

\newcommand{\fnlabel}[1]{\mathrm{#1}}
\newcommand{\fnap}[2]{\fnlabel{#1} \ap #2}

% multiple terms splitted into lines, like this:
%    A
%  + B
%  + C
% and you type:
% \begin{terms}
% & A \\
% + & B \\
% + & C
% \end{terms}
\newenvironment{terms}{\begin{array}[t]{@{}c@{\ }l}}{\end{array}}

% multiple lines, each left-justified
% \begin{lines}
% xxx + \\
% yyy + \\
% zzz
% \end{lines}
\newenvironment{lines}{\begin{array}[t]{@{}l}}{\end{array}}
%======================================

%============ MACROS =============
% Molar SI unit
\DeclareSIUnit\Molar{\textsc{m}}

% put something in quotation marks
\newcommand{\inquotes}[1]{``#1''}
\newcommand{\insquotes}[1]{`#1'}

% put something in marginfont size
\renewcommand{\marginfont}{\footnotesize\sffamily}

% question and answer macros
\newcommand{\question}{\textbf{Question:}}
\newcommand{\answer}{\emph{Answer:}}

% matrix and vector formatting macross
\newcommand{\mat}[1]{\ensuremath{\mathbb{#1}}}
\renewcommand{\vec}[1]{\ensuremath{\mathbf{#1}}}
\newcommand{\vecsymb}[1]{\ensuremath{\bm{#1}}}

% probabily P
\newcommand{\prob}{\ensuremath{\mathbb{P}}}
\newcommand{\expe}{\ensuremath{\mathbb{E}}}
\newcommand{\vari}{\ensuremath{\mathbb{V}}}

% new commands to make writing norms easier
\newcommand{\normm}[2][p]{%
	\ensuremath{\norm{\mat{#2}}_{#1}}%
}

\newcommand{\normv}[2][p]{%
	\ensuremath{\norm{\vec{#2}}_{#1}}%
}

\newcommand{\normmv}[3][p]{%
	\ensuremath{\norm{\mat{#2}\vec{#3}}_{#1}}%
}

\newcommand{\mycommand}[1]{\ensuremath{{#1}_{p}}}

\renewcommand{\vec}[1]{\ensuremath{\mathbf{#1}}}

\newcommand{\normvfrac}[2][p]{%
	\ensuremath{{}_{\phantom{#1}}\norm{\vec{#2}}_{#1}}%
}

\newcommand{\normwfrac}[2][p]{%
	\ensuremath{{}_{\!\phantom{#1}}\norm{\vec{#2}}_{#1}\!}%
}
%=================================

\newcommand{\dimeq}{\mathbin{\underline{\Delta}}}

%=================================
% "slot" symbol for combinatorics
\newcommand{\slot}[1]{\ensuremath{\underline{\phantom{#1}}}}

\renewcommand{\mod}[1]{\ensuremath{\mathrm{mod}\;{#1}}}
\renewcommand{\gcd}[2]{\ensuremath{\textrm{gcd}({#1}, {#2})}}
\newcommand{\lcd}[2]{\ensuremath{\textrm{lcd}({#1}, {#2})}}
\newcommand{\cd}[2]{\ensuremath{\textrm{cd}({#1}, {#2})}}

\newcommand{\id}{\ensuremath{\textrm{id}}}
\newcommand{\st}{\ensuremath{\textrm{ s.t. }}}

\DeclarePairedDelimiter{\newbracket}{\wr}{\wr}

\newcommand{\isomorphic}[2]{\ensuremath{\mathrm{Iso}(#1, #2)}}
\newcommand{\homomorphic}[2]{\ensuremath{\mathrm{Hom}(#1, #2)}}
\newcommand{\imageof}[2]{\ensuremath{\mathrm{Im}(#1, #2)}}

%===================================

\newcommand{\invitro}{\emph{in vitro}}
\newcommand{\invivo}{\emph{in vivo}}